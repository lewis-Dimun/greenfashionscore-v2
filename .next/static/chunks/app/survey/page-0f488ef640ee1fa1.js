(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[869],{18354:(e,t,n)=>{Promise.resolve().then(n.bind(n,91678))},91678:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>x});var r=n(95155),s=n(12115),a=n(20063);let l=n(95704).env.NEXT_PUBLIC_SUPABASE_FUNCTIONS_URL||"";var i=n(95988);let c="gfs_survey_draft";function o(e){try{window.localStorage.setItem(c,JSON.stringify(e))}catch(e){}}let d=(0,i.vt)((e,t)=>({...function(){try{let e=window.localStorage.getItem(c);if(!e)return{stepIndex:0,answers:{}};let t=JSON.parse(e);return{stepIndex:Number(t.stepIndex)||0,answers:t.answers||{}}}catch(e){return{stepIndex:0,answers:{}}}}(),setStepIndex:n=>{let r={...t(),stepIndex:n};o({stepIndex:r.stepIndex,answers:r.answers}),e({stepIndex:n})},setAnswer:(n,r)=>{let s={...t().answers,[n]:r};o({stepIndex:t().stepIndex,answers:s}),e({answers:s})},reset:()=>{let t={stepIndex:0,answers:{}};o(t),e(t)}}));var u=n(15653);let p=u.z.record(u.z.string(),u.z.string().min(1)),h=[{key:"people",title:"People"},{key:"planet",title:"Planet"},{key:"circularity",title:"Circularity"},{key:"materials",title:"Materials"}];function x(){var e;let t=d(),[n,i]=(0,s.useState)(t.stepIndex),c=(0,s.useRef)(null),[o,u]=(0,s.useState)(!1),x=(0,a.useRouter)();function w(){i(e=>{let n=Math.min(e+1,h.length-1);return t.setStepIndex(n),n})}(0,s.useEffect)(()=>{var e;null==(e=c.current)||e.focus()},[n]);let f=h[n];return(0,r.jsxs)("main",{"aria-label":"Encuesta Green Fashion Score",children:[(0,r.jsxs)("div",{role:"progressbar","aria-valuemin":1,"aria-valuemax":h.length,"aria-valuenow":n+1,children:["Paso ",n+1," de ",h.length]}),(0,r.jsxs)("section",{"aria-label":"Secci\xf3n ".concat(f.title),children:[(0,r.jsx)("h2",{tabIndex:-1,children:f.title}),(0,r.jsxs)("p",{children:["Preguntas de ",f.title," (placeholder)"]})]}),(0,r.jsxs)("nav",{"aria-label":"Controles del wizard",children:[(0,r.jsx)("button",{onClick:function(){i(e=>{let n=Math.max(e-1,0);return t.setStepIndex(n),n})},disabled:0===n,"aria-label":"Anterior",children:"Anterior"}),(0,r.jsx)("button",{ref:c,onClick:w,"aria-label":n===h.length-1?"Finalizar":"Siguiente",onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),w())},children:n===h.length-1?"Finalizar":"Siguiente"}),n===h.length-1&&(0,r.jsx)("button",{"aria-label":"Enviar encuesta",disabled:o||(e=t.answers,!p.safeParse(e).success),onClick:async()=>{u(!0);try{(await fetch(l?"".concat(l.replace(/\/$/,""),"/scoring"):"/functions/v1/scoring",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({survey_type:"general",survey_version:"v1",brand_id:null,answers:Object.entries(t.answers).map(e=>{let[t,n]=e;return{question_code:t,answer_code:n}})})})).ok&&x.push("/dashboard")}finally{u(!1)}},children:o?"Enviando...":"Enviar"})]})]})}}},e=>{e.O(0,[495,441,255,358],()=>e(e.s=18354)),_N_E=e.O()}]);